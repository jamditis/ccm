<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Media Kit Builder | Center for Cooperative Media</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- React & DOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- PDF & Canvas Libs -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>

    <!-- Typography - Editorial Stack -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Fraunces:ital,opsz,wght@0,9..144,300;0,9..144,400;0,9..144,500;0,9..144,600;0,9..144,700;1,9..144,400&family=Instrument+Sans:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        'sans': ['Instrument Sans', 'sans-serif'],
                        'serif': ['Fraunces', 'serif'],
                        'mono': ['JetBrains Mono', 'monospace'],
                    },
                    colors: {
                        ink: {
                            50: '#f6f7f9',
                            100: '#eceef2',
                            200: '#d5d9e2',
                            300: '#b0b8c9',
                            400: '#8591ab',
                            500: '#667391',
                            600: '#515c78',
                            700: '#434b62',
                            800: '#3a4153',
                            900: '#1a1d24',
                            950: '#0d0f12',
                        },
                        copper: {
                            50: '#fdf8f3',
                            100: '#f9ede0',
                            200: '#f2d9be',
                            300: '#e9bf93',
                            400: '#de9d65',
                            500: '#d68344',
                            600: '#c86d39',
                            700: '#a65531',
                            800: '#85452d',
                            900: '#6c3a27',
                        },
                        sage: {
                            50: '#f4f7f4',
                            100: '#e3ebe3',
                            200: '#c8d7c8',
                            300: '#a3baa3',
                            400: '#789778',
                            500: '#5a7a5a',
                            600: '#466146',
                            700: '#3a4f3a',
                            800: '#314131',
                            900: '#293629',
                        }
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.5s ease-out forwards',
                        'slide-up': 'slideUp 0.4s ease-out forwards',
                        'slide-in-right': 'slideInRight 0.3s ease-out forwards',
                        'pulse-soft': 'pulseSoft 2s ease-in-out infinite',
                        'toast-in': 'toastIn 0.4s ease-out forwards',
                        'toast-out': 'toastOut 0.3s ease-in forwards',
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0' },
                            '100%': { opacity: '1' },
                        },
                        slideUp: {
                            '0%': { opacity: '0', transform: 'translateY(10px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        },
                        slideInRight: {
                            '0%': { opacity: '0', transform: 'translateX(-10px)' },
                            '100%': { opacity: '1', transform: 'translateX(0)' },
                        },
                        pulseSoft: {
                            '0%, 100%': { opacity: '1' },
                            '50%': { opacity: '0.7' },
                        },
                        toastIn: {
                            '0%': { opacity: '0', transform: 'translateY(-20px) scale(0.95)' },
                            '100%': { opacity: '1', transform: 'translateY(0) scale(1)' },
                        },
                        toastOut: {
                            '0%': { opacity: '1', transform: 'translateY(0) scale(1)' },
                            '100%': { opacity: '0', transform: 'translateY(-10px) scale(0.95)' },
                        }
                    }
                }
            }
        }
    </script>

    <style>
        body {
            background: linear-gradient(135deg, #f6f7f9 0%, #eceef2 50%, #f6f7f9 100%);
            font-family: 'Instrument Sans', sans-serif;
        }

        /* Subtle pattern overlay */
        body::before {
            content: '';
            position: fixed;
            inset: 0;
            background-image:
                radial-gradient(circle at 25% 25%, rgba(214, 131, 68, 0.03) 0%, transparent 50%),
                radial-gradient(circle at 75% 75%, rgba(102, 115, 145, 0.03) 0%, transparent 50%);
            pointer-events: none;
            z-index: 0;
        }

        .input-field {
            @apply w-full px-3 py-2.5 bg-white border border-ink-200 rounded-lg text-sm transition-all duration-200;
        }
        .input-field:focus {
            @apply outline-none border-copper-500 ring-2 ring-copper-500/20;
        }
        .input-field:hover:not(:focus) {
            @apply border-ink-300;
        }

        .section-card {
            @apply bg-white rounded-xl border border-ink-100 overflow-hidden shadow-sm;
        }

        .section-header {
            @apply px-4 py-3.5 bg-gradient-to-r from-ink-50 to-transparent border-b border-ink-100 flex items-center justify-between cursor-pointer transition-all duration-200;
        }
        .section-header:hover {
            @apply from-ink-100;
        }

        .btn {
            @apply px-4 py-2 rounded-lg font-medium text-sm transition-all duration-200 transform active:scale-[0.98];
        }
        .btn-primary {
            @apply bg-ink-900 text-white hover:bg-ink-800 shadow-lg shadow-ink-900/20;
        }
        .btn-secondary {
            @apply bg-ink-100 text-ink-700 hover:bg-ink-200;
        }
        .btn-copper {
            @apply bg-copper-500 text-white hover:bg-copper-600 shadow-lg shadow-copper-500/20;
        }

        /* Custom scrollbar */
        .custom-scroll::-webkit-scrollbar { width: 6px; height: 6px; }
        .custom-scroll::-webkit-scrollbar-track { background: transparent; }
        .custom-scroll::-webkit-scrollbar-thumb { background: #d5d9e2; border-radius: 3px; }
        .custom-scroll::-webkit-scrollbar-thumb:hover { background: #b0b8c9; }

        /* Print styles */
        @media print {
            body { background: white; }
            body::before { display: none; }
            .no-print { display: none !important; }
            .print-container { box-shadow: none !important; }
        }

        /* Mobile */
        @media screen and (max-width: 768px) {
            input, select, textarea { font-size: 16px !important; }
        }

        /* Drag and drop styles */
        .dragging {
            @apply opacity-50 scale-[0.98];
        }
        .drag-over {
            @apply ring-2 ring-copper-500 ring-offset-2;
        }

        /* Tooltip styles */
        .tooltip {
            @apply invisible opacity-0 absolute z-50 px-2 py-1 text-xs bg-ink-900 text-white rounded shadow-lg transition-all duration-200;
        }
        .tooltip-trigger:hover .tooltip {
            @apply visible opacity-100;
        }

        /* Progress ring */
        .progress-ring {
            transform: rotate(-90deg);
        }
        .progress-ring circle {
            transition: stroke-dashoffset 0.35s;
        }
    </style>
</head>
<body class="min-h-screen relative">

    <div id="root" class="relative z-10"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useCallback } = React;

        // --- ICONS ---
        const IconFileText = ({className}) => <svg className={className} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>;
        const IconChevronDown = ({className}) => <svg className={className} xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="6 9 12 15 18 9"/></svg>;
        const IconPlus = ({className}) => <svg className={className} xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>;
        const IconTrash = ({className}) => <svg className={className} xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg>;
        const IconDownload = ({className}) => <svg className={className} xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" x2="12" y1="15" y2="3"/></svg>;
        const IconSave = ({className}) => <svg className={className} xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></svg>;
        const IconEye = ({className}) => <svg className={className} xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>;
        const IconEdit = ({className}) => <svg className={className} xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>;
        const IconImage = ({className}) => <svg className={className} xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"/><circle cx="8.5" cy="8.5" r="1.5"/><polyline points="21 15 16 10 5 21"/></svg>;
        const IconGripVertical = ({className}) => <svg className={className} xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="9" cy="12" r="1"/><circle cx="9" cy="5" r="1"/><circle cx="9" cy="19" r="1"/><circle cx="15" cy="12" r="1"/><circle cx="15" cy="5" r="1"/><circle cx="15" cy="19" r="1"/></svg>;
        const IconInfo = ({className}) => <svg className={className} xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/></svg>;
        const IconCheck = ({className}) => <svg className={className} xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="20 6 9 17 4 12"/></svg>;
        const IconX = ({className}) => <svg className={className} xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>;
        const IconNewspaper = ({className}) => <svg className={className} xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M4 22h16a2 2 0 0 0 2-2V4a2 2 0 0 0-2-2H8a2 2 0 0 0-2 2v16a2 2 0 0 1-2 2zm0 0a2 2 0 0 1-2-2v-9c0-1.1.9-2 2-2h2"/><path d="M18 14h-8"/><path d="M15 18h-5"/><path d="M10 6h8v4h-8V6z"/></svg>;

        // --- TOAST SYSTEM ---
        const ToastContext = React.createContext();

        const ToastProvider = ({ children }) => {
            const [toasts, setToasts] = useState([]);

            const addToast = useCallback((message, type = 'success', duration = 3000) => {
                const id = Date.now();
                setToasts(prev => [...prev, { id, message, type, exiting: false }]);
                setTimeout(() => {
                    setToasts(prev => prev.map(t => t.id === id ? { ...t, exiting: true } : t));
                    setTimeout(() => {
                        setToasts(prev => prev.filter(t => t.id !== id));
                    }, 300);
                }, duration);
            }, []);

            return (
                <ToastContext.Provider value={addToast}>
                    {children}
                    <div className="fixed top-4 right-4 z-50 space-y-2">
                        {toasts.map(toast => (
                            <div
                                key={toast.id}
                                className={`px-4 py-3 rounded-lg shadow-lg flex items-center gap-2 ${
                                    toast.exiting ? 'animate-toast-out' : 'animate-toast-in'
                                } ${
                                    toast.type === 'success' ? 'bg-sage-600 text-white' :
                                    toast.type === 'error' ? 'bg-red-600 text-white' :
                                    'bg-ink-800 text-white'
                                }`}
                            >
                                {toast.type === 'success' && <IconCheck className="w-4 h-4" />}
                                {toast.type === 'error' && <IconX className="w-4 h-4" />}
                                <span className="text-sm font-medium">{toast.message}</span>
                            </div>
                        ))}
                    </div>
                </ToastContext.Provider>
            );
        };

        const useToast = () => React.useContext(ToastContext);

        // --- RATE CARD TEMPLATES ---
        const RATE_TEMPLATES = {
            standard: {
                name: 'Standard',
                multiplier: 1,
                description: 'Regular market rates'
            },
            premium: {
                name: 'Premium',
                multiplier: 1.5,
                description: 'Premium positioning & guaranteed placement'
            },
            nonprofit: {
                name: 'Nonprofit',
                multiplier: 0.7,
                description: 'Discounted rates for nonprofits'
            }
        };

        // --- MEDIA KIT TEMPLATES ---
        const MEDIA_KIT_TEMPLATES = {
            local_newspaper: {
                id: 'local_newspaper',
                name: 'Local Newspaper',
                description: 'Traditional local news outlet with print and digital presence',
                icon: 'ðŸ“°',
                color: '#1a1d24',
                organization: {
                    tagline: 'Your trusted source for local news',
                    mission: 'We are committed to delivering accurate, timely, and relevant news coverage that keeps our community informed and engaged. Our journalism upholds the highest standards of integrity while serving the public interest.',
                    foundedYear: 1985
                },
                audience: {
                    totalReach: 50000,
                    demographics: {
                        ageRanges: [
                            { range: '18-24', percentage: 8 },
                            { range: '25-34', percentage: 18 },
                            { range: '35-44', percentage: 22 },
                            { range: '45-54', percentage: 26 },
                            { range: '55+', percentage: 26 }
                        ],
                        locations: [
                            { area: 'City Center', percentage: 40 },
                            { area: 'Suburbs', percentage: 35 },
                            { area: 'Rural Areas', percentage: 25 }
                        ],
                        interests: ['Local News', 'Politics', 'Community Events', 'Sports', 'Business']
                    }
                },
                platforms: [
                    { name: 'Website', enabled: true },
                    { name: 'Newsletter', enabled: true },
                    { name: 'Social Media', enabled: true },
                    { name: 'Podcast', enabled: false },
                    { name: 'Print', enabled: true }
                ],
                theme: {
                    primaryColor: '#1a1d24',
                    accentColor: '#c86d39'
                }
            },
            digital_outlet: {
                id: 'digital_outlet',
                name: 'Digital-Only Outlet',
                description: 'Modern digital news organization focused on web and social',
                icon: 'ðŸ’»',
                color: '#2563eb',
                organization: {
                    tagline: 'News for the digital age',
                    mission: 'We deliver fast, accurate news coverage optimized for how modern readers consume information. Our digital-first approach ensures our audience stays informed across all their devices.',
                    foundedYear: 2018
                },
                audience: {
                    totalReach: 150000,
                    demographics: {
                        ageRanges: [
                            { range: '18-24', percentage: 22 },
                            { range: '25-34', percentage: 35 },
                            { range: '35-44', percentage: 25 },
                            { range: '45-54', percentage: 12 },
                            { range: '55+', percentage: 6 }
                        ],
                        locations: [
                            { area: 'Metro Area', percentage: 60 },
                            { area: 'Statewide', percentage: 30 },
                            { area: 'National', percentage: 10 }
                        ],
                        interests: ['Breaking News', 'Technology', 'Politics', 'Culture', 'Business']
                    }
                },
                platforms: [
                    { name: 'Website', enabled: true },
                    { name: 'Newsletter', enabled: true },
                    { name: 'Social Media', enabled: true },
                    { name: 'Podcast', enabled: false },
                    { name: 'Print', enabled: false }
                ],
                theme: {
                    primaryColor: '#2563eb',
                    accentColor: '#f59e0b'
                }
            },
            podcast_network: {
                id: 'podcast_network',
                name: 'Podcast Network',
                description: 'Audio-first news and storytelling organization',
                icon: 'ðŸŽ™ï¸',
                color: '#7c3aed',
                organization: {
                    tagline: 'Stories worth hearing',
                    mission: 'We produce compelling audio journalism that informs, entertains, and connects listeners to the stories that matter. Our podcasts combine rigorous reporting with engaging storytelling.',
                    foundedYear: 2019
                },
                audience: {
                    totalReach: 75000,
                    demographics: {
                        ageRanges: [
                            { range: '18-24', percentage: 18 },
                            { range: '25-34', percentage: 38 },
                            { range: '35-44', percentage: 28 },
                            { range: '45-54', percentage: 12 },
                            { range: '55+', percentage: 4 }
                        ],
                        locations: [
                            { area: 'National', percentage: 70 },
                            { area: 'Regional', percentage: 20 },
                            { area: 'International', percentage: 10 }
                        ],
                        interests: ['Podcasts', 'Investigative Journalism', 'True Crime', 'Politics', 'Culture']
                    }
                },
                platforms: [
                    { name: 'Website', enabled: true },
                    { name: 'Newsletter', enabled: true },
                    { name: 'Social Media', enabled: true },
                    { name: 'Podcast', enabled: true },
                    { name: 'Print', enabled: false }
                ],
                theme: {
                    primaryColor: '#7c3aed',
                    accentColor: '#ec4899'
                }
            },
            newsletter_publisher: {
                id: 'newsletter_publisher',
                name: 'Newsletter Publisher',
                description: 'Email-first publication with dedicated subscriber base',
                icon: 'ðŸ“§',
                color: '#059669',
                organization: {
                    tagline: 'Curated news, delivered daily',
                    mission: 'We cut through the noise to deliver the news that matters most, directly to your inbox. Our newsletters are carefully curated to save you time while keeping you informed.',
                    foundedYear: 2020
                },
                audience: {
                    totalReach: 25000,
                    demographics: {
                        ageRanges: [
                            { range: '18-24', percentage: 12 },
                            { range: '25-34', percentage: 32 },
                            { range: '35-44', percentage: 30 },
                            { range: '45-54', percentage: 18 },
                            { range: '55+', percentage: 8 }
                        ],
                        locations: [
                            { area: 'Urban Professionals', percentage: 55 },
                            { area: 'Suburban', percentage: 30 },
                            { area: 'Other', percentage: 15 }
                        ],
                        interests: ['Business', 'Finance', 'Technology', 'Career', 'Industry News']
                    }
                },
                platforms: [
                    { name: 'Website', enabled: false },
                    { name: 'Newsletter', enabled: true },
                    { name: 'Social Media', enabled: true },
                    { name: 'Podcast', enabled: false },
                    { name: 'Print', enabled: false }
                ],
                theme: {
                    primaryColor: '#059669',
                    accentColor: '#d68344'
                }
            }
        };

        // Icon for templates
        const IconTemplate = ({className}) => <svg className={className} xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"/><line x1="3" y1="9" x2="21" y2="9"/><line x1="9" y1="21" x2="9" y2="9"/></svg>;
        const IconPackage = ({className}) => <svg className={className} xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M16.5 9.4l-9-5.19M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/><polyline points="3.27 6.96 12 12.01 20.73 6.96"/><line x1="12" y1="22.08" x2="12" y2="12"/></svg>;

        // --- DEFAULT PLATFORMS ---
        const getDefaultPlatforms = () => [
            {
                id: 1,
                name: 'Website',
                icon: 'web',
                enabled: true,
                metrics: [
                    { label: 'Monthly Visitors', value: '' },
                    { label: 'Page Views', value: '' },
                    { label: 'Avg. Time on Site', value: '' }
                ],
                adOptions: [
                    { name: 'Leaderboard (728x90)', description: 'Top of page banner', rate: '', specs: 'JPG/PNG/GIF, max 150KB' }
                ]
            },
            {
                id: 2,
                name: 'Newsletter',
                icon: 'email',
                enabled: true,
                metrics: [
                    { label: 'Subscribers', value: '' },
                    { label: 'Open Rate', value: '' },
                    { label: 'Click Rate', value: '' }
                ],
                adOptions: [
                    { name: 'Sponsored Section', description: 'Dedicated sponsor message', rate: '', specs: '150 words + image' }
                ]
            },
            {
                id: 3,
                name: 'Social Media',
                icon: 'social',
                enabled: false,
                metrics: [
                    { label: 'Total Followers', value: '' },
                    { label: 'Engagement Rate', value: '' }
                ],
                adOptions: [
                    { name: 'Sponsored Post', description: 'Native social content', rate: '', specs: 'Platform-specific' }
                ]
            },
            {
                id: 4,
                name: 'Podcast',
                icon: 'audio',
                enabled: false,
                metrics: [
                    { label: 'Downloads/Episode', value: '' },
                    { label: 'Total Episodes', value: '' }
                ],
                adOptions: [
                    { name: 'Pre-roll (30s)', description: 'Beginning of episode', rate: '', specs: 'Host-read or produced' },
                    { name: 'Mid-roll (60s)', description: 'Middle of episode', rate: '', specs: 'Host-read or produced' }
                ]
            },
            {
                id: 5,
                name: 'Print',
                icon: 'print',
                enabled: false,
                metrics: [
                    { label: 'Circulation', value: '' },
                    { label: 'Distribution Area', value: '' },
                    { label: 'Frequency', value: '' }
                ],
                adOptions: [
                    { name: 'Full Page', description: 'Full page ad', rate: '', specs: '8.5x11", 300 DPI, CMYK' },
                    { name: 'Half Page', description: 'Half page ad', rate: '', specs: '8.5x5.5", 300 DPI, CMYK' },
                    { name: 'Quarter Page', description: 'Quarter page ad', rate: '', specs: '4.25x5.5", 300 DPI, CMYK' }
                ]
            }
        ];

        const MediaKitBuilder = () => {
            const addToast = useToast();

            // --- STATE ---
            const [activeTab, setActiveTab] = useState('editor');
            const [expandedSections, setExpandedSections] = useState(['organization', 'audience', 'platforms']);

            const [organization, setOrganization] = useState({
                name: '',
                logo: null,
                tagline: '',
                mission: '',
                foundedYear: new Date().getFullYear(),
                website: '',
                contact: { name: '', email: '', phone: '' }
            });

            const [audience, setAudience] = useState({
                totalReach: 0,
                demographics: {
                    ageRanges: [
                        { range: '18-24', percentage: 15 },
                        { range: '25-34', percentage: 30 },
                        { range: '35-44', percentage: 25 },
                        { range: '45-54', percentage: 18 },
                        { range: '55+', percentage: 12 },
                    ],
                    locations: [
                        { area: '', percentage: 0 }
                    ],
                    interests: []
                }
            });

            const [platforms, setPlatforms] = useState(getDefaultPlatforms());
            const [testimonials, setTestimonials] = useState([]);
            const [packages, setPackages] = useState([]);
            const [rateTemplate, setRateTemplate] = useState('standard');

            const [theme, setTheme] = useState({
                primaryColor: '#1a1d24',
                accentColor: '#d68344',
                fontStyle: 'editorial'
            });

            const [profiles, setProfiles] = useState([]);
            const [isGenerating, setIsGenerating] = useState(false);
            const [exportType, setExportType] = useState('pdf');
            const [draggedPlatform, setDraggedPlatform] = useState(null);
            const [showTemplateModal, setShowTemplateModal] = useState(false);
            const autoSaveRef = useRef(null);

            // --- COMPUTED VALUES ---
            const completionPercentage = React.useMemo(() => {
                let score = 0;
                let total = 0;

                // Organization (40 points)
                total += 40;
                if (organization.name) score += 10;
                if (organization.logo) score += 5;
                if (organization.tagline) score += 5;
                if (organization.mission) score += 10;
                if (organization.contact.name) score += 5;
                if (organization.contact.email) score += 5;

                // Audience (30 points)
                total += 30;
                if (audience.totalReach > 0) score += 15;
                if (audience.demographics.locations.some(l => l.area)) score += 10;
                if (audience.demographics.interests.length > 0) score += 5;

                // Platforms (30 points)
                total += 30;
                const enabledPlatforms = platforms.filter(p => p.enabled);
                if (enabledPlatforms.length > 0) {
                    score += 10;
                    const withMetrics = enabledPlatforms.filter(p => p.metrics.some(m => m.value));
                    const withRates = enabledPlatforms.filter(p => p.adOptions.some(o => o.rate));
                    if (withMetrics.length > 0) score += 10;
                    if (withRates.length > 0) score += 10;
                }

                return Math.round((score / total) * 100);
            }, [organization, audience, platforms]);

            const ageRangeTotal = React.useMemo(() => {
                return audience.demographics.ageRanges.reduce((sum, r) => sum + r.percentage, 0);
            }, [audience.demographics.ageRanges]);

            // --- EFFECTS ---
            useEffect(() => {
                const saved = localStorage.getItem('media_kit_profiles');
                if (saved) setProfiles(JSON.parse(saved));

                // Auto-save draft
                const draft = localStorage.getItem('media_kit_draft');
                if (draft) {
                    const { organization: org, audience: aud, platforms: plat, testimonials: test, packages: pkg, theme: th, rateTemplate: rt } = JSON.parse(draft);
                    if (org) setOrganization(org);
                    if (aud) setAudience(aud);
                    if (plat) setPlatforms(plat);
                    if (test) setTestimonials(test);
                    if (pkg) setPackages(pkg);
                    if (th) setTheme(th);
                    if (rt) setRateTemplate(rt);
                }

                // Handle responsive tab switching
                const handleResize = () => {
                    if (window.innerWidth >= 1024) {
                        setActiveTab('split');
                    } else if (activeTab === 'split') {
                        setActiveTab('editor');
                    }
                };
                window.addEventListener('resize', handleResize);
                handleResize();
                return () => window.removeEventListener('resize', handleResize);
            }, []);

            // Auto-save effect
            useEffect(() => {
                if (autoSaveRef.current) clearTimeout(autoSaveRef.current);
                autoSaveRef.current = setTimeout(() => {
                    localStorage.setItem('media_kit_draft', JSON.stringify({
                        organization, audience, platforms, testimonials, packages, theme, rateTemplate
                    }));
                }, 1000);
            }, [organization, audience, platforms, testimonials, packages, theme, rateTemplate]);

            // --- HANDLERS ---
            const toggleSection = (section) => {
                setExpandedSections(prev =>
                    prev.includes(section)
                        ? prev.filter(s => s !== section)
                        : [...prev, section]
                );
            };

            const handleLogoUpload = (e) => {
                const file = e.target.files[0];
                if (file) {
                    if (file.size > 5 * 1024 * 1024) {
                        addToast('Logo file must be under 5MB', 'error');
                        return;
                    }
                    const reader = new FileReader();
                    reader.onloadend = () => {
                        setOrganization(prev => ({ ...prev, logo: reader.result }));
                        addToast('Logo uploaded successfully', 'success');
                    };
                    reader.readAsDataURL(file);
                }
            };

            const updateAgeRange = (index, field, value) => {
                const updated = [...audience.demographics.ageRanges];
                updated[index] = { ...updated[index], [field]: field === 'percentage' ? parseInt(value) || 0 : value };
                setAudience(prev => ({
                    ...prev,
                    demographics: { ...prev.demographics, ageRanges: updated }
                }));
            };

            const updateLocation = (index, field, value) => {
                const updated = [...audience.demographics.locations];
                updated[index] = { ...updated[index], [field]: field === 'percentage' ? parseInt(value) || 0 : value };
                setAudience(prev => ({
                    ...prev,
                    demographics: { ...prev.demographics, locations: updated }
                }));
            };

            const addLocation = () => {
                setAudience(prev => ({
                    ...prev,
                    demographics: {
                        ...prev.demographics,
                        locations: [...prev.demographics.locations, { area: '', percentage: 0 }]
                    }
                }));
            };

            const removeLocation = (index) => {
                setAudience(prev => ({
                    ...prev,
                    demographics: {
                        ...prev.demographics,
                        locations: prev.demographics.locations.filter((_, i) => i !== index)
                    }
                }));
            };

            const togglePlatform = (id) => {
                setPlatforms(prev => prev.map(p =>
                    p.id === id ? { ...p, enabled: !p.enabled } : p
                ));
            };

            const updatePlatformMetric = (platformId, metricIndex, value) => {
                setPlatforms(prev => prev.map(p => {
                    if (p.id === platformId) {
                        const metrics = [...p.metrics];
                        metrics[metricIndex] = { ...metrics[metricIndex], value };
                        return { ...p, metrics };
                    }
                    return p;
                }));
            };

            const updateAdOption = (platformId, optionIndex, field, value) => {
                setPlatforms(prev => prev.map(p => {
                    if (p.id === platformId) {
                        const adOptions = [...p.adOptions];
                        adOptions[optionIndex] = { ...adOptions[optionIndex], [field]: value };
                        return { ...p, adOptions };
                    }
                    return p;
                }));
            };

            const addAdOption = (platformId) => {
                setPlatforms(prev => prev.map(p => {
                    if (p.id === platformId) {
                        return {
                            ...p,
                            adOptions: [...p.adOptions, { name: '', description: '', rate: '', specs: '' }]
                        };
                    }
                    return p;
                }));
            };

            const removeAdOption = (platformId, optionIndex) => {
                setPlatforms(prev => prev.map(p => {
                    if (p.id === platformId) {
                        return {
                            ...p,
                            adOptions: p.adOptions.filter((_, i) => i !== optionIndex)
                        };
                    }
                    return p;
                }));
            };

            const addTestimonial = () => {
                setTestimonials([...testimonials, { id: Date.now(), quote: '', source: '' }]);
            };

            const updateTestimonial = (id, field, value) => {
                setTestimonials(prev => prev.map(t =>
                    t.id === id ? { ...t, [field]: value } : t
                ));
            };

            const removeTestimonial = (id) => {
                setTestimonials(prev => prev.filter(t => t.id !== id));
            };

            // Package management
            const addPackage = () => {
                setPackages([...packages, {
                    id: Date.now(),
                    name: '',
                    description: '',
                    items: [],
                    totalValue: '',
                    price: '',
                    savings: ''
                }]);
            };

            const updatePackage = (id, field, value) => {
                setPackages(prev => prev.map(p =>
                    p.id === id ? { ...p, [field]: value } : p
                ));
            };

            const removePackage = (id) => {
                setPackages(prev => prev.filter(p => p.id !== id));
            };

            const addPackageItem = (packageId) => {
                setPackages(prev => prev.map(p => {
                    if (p.id === packageId) {
                        return {
                            ...p,
                            items: [...p.items, { id: Date.now(), platform: '', adOption: '', quantity: 1 }]
                        };
                    }
                    return p;
                }));
            };

            const updatePackageItem = (packageId, itemId, field, value) => {
                setPackages(prev => prev.map(p => {
                    if (p.id === packageId) {
                        return {
                            ...p,
                            items: p.items.map(item =>
                                item.id === itemId ? { ...item, [field]: value } : item
                            )
                        };
                    }
                    return p;
                }));
            };

            const removePackageItem = (packageId, itemId) => {
                setPackages(prev => prev.map(p => {
                    if (p.id === packageId) {
                        return {
                            ...p,
                            items: p.items.filter(item => item.id !== itemId)
                        };
                    }
                    return p;
                }));
            };

            const addPresetPackage = (preset) => {
                const enabledPlatformsList = platforms.filter(p => p.enabled);
                if (enabledPlatformsList.length === 0) {
                    addToast('Enable at least one platform first', 'error');
                    return;
                }

                let newPackage = {
                    id: Date.now(),
                    name: '',
                    description: '',
                    items: [],
                    totalValue: '',
                    price: '',
                    savings: '10%'
                };

                if (preset === 'starter') {
                    newPackage.name = 'Starter Package';
                    newPackage.description = 'Perfect for testing the waters with our audience';
                    newPackage.savings = '10%';
                } else if (preset === 'growth') {
                    newPackage.name = 'Growth Package';
                    newPackage.description = 'Increased visibility across multiple channels';
                    newPackage.savings = '15%';
                } else if (preset === 'premium') {
                    newPackage.name = 'Premium Package';
                    newPackage.description = 'Maximum exposure with priority placement';
                    newPackage.savings = '20%';
                }

                setPackages([...packages, newPackage]);
                addToast(`${newPackage.name} added`, 'success');
            };

            // Drag and drop handlers
            const handleDragStart = (e, platformId) => {
                setDraggedPlatform(platformId);
                e.dataTransfer.effectAllowed = 'move';
            };

            const handleDragOver = (e, platformId) => {
                e.preventDefault();
                if (draggedPlatform && draggedPlatform !== platformId) {
                    const dragIndex = platforms.findIndex(p => p.id === draggedPlatform);
                    const hoverIndex = platforms.findIndex(p => p.id === platformId);
                    const newPlatforms = [...platforms];
                    const [removed] = newPlatforms.splice(dragIndex, 1);
                    newPlatforms.splice(hoverIndex, 0, removed);
                    setPlatforms(newPlatforms);
                }
            };

            const handleDragEnd = () => {
                setDraggedPlatform(null);
            };

            // Profile management
            const saveProfile = () => {
                const name = prompt("Profile name:");
                if (!name) return;
                const profile = {
                    id: Date.now(),
                    name,
                    data: { organization, audience, platforms, testimonials, packages, theme, rateTemplate }
                };
                const updated = [...profiles, profile];
                setProfiles(updated);
                localStorage.setItem('media_kit_profiles', JSON.stringify(updated));
                addToast(`Profile "${name}" saved`, 'success');
            };

            const loadProfile = (profileId) => {
                const profile = profiles.find(p => p.id === Number(profileId));
                if (profile) {
                    setOrganization(profile.data.organization);
                    setAudience(profile.data.audience);
                    setPlatforms(profile.data.platforms || getDefaultPlatforms());
                    setTestimonials(profile.data.testimonials || []);
                    setPackages(profile.data.packages || []);
                    if (profile.data.theme) setTheme(profile.data.theme);
                    if (profile.data.rateTemplate) setRateTemplate(profile.data.rateTemplate);
                    addToast(`Loaded "${profile.name}"`, 'success');
                }
            };

            const deleteProfile = (profileId) => {
                const profile = profiles.find(p => p.id === Number(profileId));
                if (profile && confirm(`Delete profile "${profile.name}"?`)) {
                    const updated = profiles.filter(p => p.id !== Number(profileId));
                    setProfiles(updated);
                    localStorage.setItem('media_kit_profiles', JSON.stringify(updated));
                    addToast(`Profile deleted`, 'success');
                }
            };

            const clearDraft = () => {
                if (confirm('Clear all current data and start fresh?')) {
                    setOrganization({
                        name: '',
                        logo: null,
                        tagline: '',
                        mission: '',
                        foundedYear: new Date().getFullYear(),
                        website: '',
                        contact: { name: '', email: '', phone: '' }
                    });
                    setAudience({
                        totalReach: 0,
                        demographics: {
                            ageRanges: [
                                { range: '18-24', percentage: 15 },
                                { range: '25-34', percentage: 30 },
                                { range: '35-44', percentage: 25 },
                                { range: '45-54', percentage: 18 },
                                { range: '55+', percentage: 12 },
                            ],
                            locations: [{ area: '', percentage: 0 }],
                            interests: []
                        }
                    });
                    setPlatforms(getDefaultPlatforms());
                    setTestimonials([]);
                    setPackages([]);
                    localStorage.removeItem('media_kit_draft');
                    addToast('Draft cleared', 'success');
                }
            };

            const applyTemplate = (templateId) => {
                const template = MEDIA_KIT_TEMPLATES[templateId];
                if (!template) return;

                // Apply organization defaults (keep name empty for user to fill)
                setOrganization(prev => ({
                    ...prev,
                    name: '',
                    logo: null,
                    tagline: template.organization.tagline,
                    mission: template.organization.mission,
                    foundedYear: template.organization.foundedYear,
                    website: '',
                    contact: { name: '', email: '', phone: '' }
                }));

                // Apply audience defaults
                setAudience({
                    totalReach: template.audience.totalReach,
                    demographics: template.audience.demographics
                });

                // Apply platform settings
                const newPlatforms = getDefaultPlatforms().map(platform => {
                    const templatePlatform = template.platforms.find(p => p.name === platform.name);
                    return {
                        ...platform,
                        enabled: templatePlatform ? templatePlatform.enabled : platform.enabled
                    };
                });
                setPlatforms(newPlatforms);

                // Apply theme
                setTheme({
                    primaryColor: template.theme.primaryColor,
                    accentColor: template.theme.accentColor,
                    fontStyle: 'editorial'
                });

                // Clear testimonials for fresh start
                setTestimonials([]);

                setShowTemplateModal(false);
                addToast(`Template "${template.name}" applied`, 'success');
            };

            const handleDownload = async () => {
                setIsGenerating(true);
                const element = document.getElementById('media-kit-preview');

                try {
                    if (exportType === 'pdf') {
                        const opt = {
                            margin: 0.5,
                            filename: `${organization.name || 'Media'}_Kit.pdf`,
                            image: { type: 'jpeg', quality: 0.98 },
                            html2canvas: { scale: 2, useCORS: true, logging: false },
                            jsPDF: { unit: 'in', format: 'letter', orientation: 'portrait' },
                            pagebreak: { mode: ['avoid-all', 'css', 'legacy'] }
                        };
                        await html2pdf().set(opt).from(element).save();
                        addToast('PDF downloaded successfully', 'success');
                    } else {
                        const canvas = await html2canvas(element, { scale: 2, useCORS: true, logging: false });
                        const link = document.createElement('a');
                        link.download = `${organization.name || 'Media'}_Kit.png`;
                        link.href = canvas.toDataURL('image/png');
                        link.click();
                        addToast('PNG downloaded successfully', 'success');
                    }
                } catch (error) {
                    addToast('Export failed. Please try again.', 'error');
                    console.error(error);
                }

                setIsGenerating(false);
            };

            // --- COMPONENTS ---

            // Tooltip wrapper
            const Tooltip = ({ children, text }) => (
                <span className="tooltip-trigger relative inline-flex">
                    {children}
                    <span className="tooltip -top-8 left-1/2 -translate-x-1/2 whitespace-nowrap">
                        {text}
                    </span>
                </span>
            );

            // Progress Ring
            const ProgressRing = ({ percentage }) => {
                const radius = 20;
                const stroke = 3;
                const normalizedRadius = radius - stroke * 2;
                const circumference = normalizedRadius * 2 * Math.PI;
                const strokeDashoffset = circumference - (percentage / 100) * circumference;

                return (
                    <div className="relative inline-flex items-center justify-center">
                        <svg height={radius * 2} width={radius * 2} className="progress-ring">
                            <circle
                                stroke="#e5e7eb"
                                fill="transparent"
                                strokeWidth={stroke}
                                r={normalizedRadius}
                                cx={radius}
                                cy={radius}
                            />
                            <circle
                                stroke={percentage >= 70 ? '#5a7a5a' : percentage >= 40 ? '#d68344' : '#667391'}
                                fill="transparent"
                                strokeWidth={stroke}
                                strokeDasharray={circumference + ' ' + circumference}
                                style={{ strokeDashoffset }}
                                strokeLinecap="round"
                                r={normalizedRadius}
                                cx={radius}
                                cy={radius}
                            />
                        </svg>
                        <span className="absolute text-[10px] font-bold text-ink-600">{percentage}%</span>
                    </div>
                );
            };

            // Collapsible Section Component
            const CollapsibleSection = ({ id, title, children, badge }) => {
                const isExpanded = expandedSections.includes(id);
                return (
                    <div className="section-card mb-4 animate-slide-up" style={{ animationDelay: `${id === 'theme' ? 0 : 50}ms` }}>
                        <div className="section-header" onClick={() => toggleSection(id)}>
                            <div className="flex items-center gap-2">
                                <h3 className="font-semibold text-sm text-ink-700">{title}</h3>
                                {badge && <span className="px-1.5 py-0.5 bg-copper-100 text-copper-700 text-[10px] font-medium rounded">{badge}</span>}
                            </div>
                            <IconChevronDown className={`text-ink-400 transition-transform duration-200 ${isExpanded ? 'rotate-180' : ''}`} />
                        </div>
                        {isExpanded && (
                            <div className="p-4 animate-fade-in">
                                {children}
                            </div>
                        )}
                    </div>
                );
            };

            // Template Modal Component
            const TemplateModal = () => {
                if (!showTemplateModal) return null;

                return (
                    <div className="fixed inset-0 z-50 flex items-center justify-center p-4">
                        {/* Backdrop */}
                        <div
                            className="absolute inset-0 bg-ink-900/60 backdrop-blur-sm animate-fade-in"
                            onClick={() => setShowTemplateModal(false)}
                        />

                        {/* Modal */}
                        <div className="relative bg-white rounded-2xl shadow-2xl w-full max-w-3xl max-h-[85vh] overflow-hidden animate-slide-up">
                            {/* Header */}
                            <div className="p-6 border-b border-ink-100">
                                <div className="flex items-center justify-between">
                                    <div>
                                        <h2 className="text-xl font-bold text-ink-900 font-serif">Choose a Template</h2>
                                        <p className="text-sm text-ink-500 mt-1">Start with pre-configured settings for your organization type</p>
                                    </div>
                                    <button
                                        onClick={() => setShowTemplateModal(false)}
                                        className="p-2 text-ink-400 hover:text-ink-600 hover:bg-ink-100 rounded-lg transition-colors"
                                    >
                                        <IconX />
                                    </button>
                                </div>
                            </div>

                            {/* Template Grid */}
                            <div className="p-6 overflow-y-auto custom-scroll" style={{ maxHeight: 'calc(85vh - 100px)' }}>
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    {Object.values(MEDIA_KIT_TEMPLATES).map(template => (
                                        <button
                                            key={template.id}
                                            onClick={() => applyTemplate(template.id)}
                                            className="text-left p-5 rounded-xl border-2 border-ink-100 hover:border-copper-300 hover:bg-copper-50/30 transition-all duration-200 group"
                                        >
                                            <div className="flex items-start gap-4">
                                                <div
                                                    className="w-12 h-12 rounded-xl flex items-center justify-center text-2xl flex-shrink-0"
                                                    style={{ backgroundColor: template.color + '15' }}
                                                >
                                                    {template.icon}
                                                </div>
                                                <div className="flex-1 min-w-0">
                                                    <h3 className="font-semibold text-ink-900 group-hover:text-copper-700 transition-colors">
                                                        {template.name}
                                                    </h3>
                                                    <p className="text-sm text-ink-500 mt-1">
                                                        {template.description}
                                                    </p>
                                                    <div className="flex flex-wrap gap-1.5 mt-3">
                                                        {template.platforms.filter(p => p.enabled).map(p => (
                                                            <span
                                                                key={p.name}
                                                                className="px-2 py-0.5 text-[10px] font-medium rounded-full"
                                                                style={{ backgroundColor: template.color + '15', color: template.color }}
                                                            >
                                                                {p.name}
                                                            </span>
                                                        ))}
                                                    </div>
                                                    <div className="flex items-center gap-3 mt-3 text-xs text-ink-400">
                                                        <span>{template.audience.totalReach.toLocaleString()} reach</span>
                                                        <span>â€¢</span>
                                                        <span>Est. {template.organization.foundedYear}</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </button>
                                    ))}
                                </div>

                                {/* Note */}
                                <p className="text-xs text-ink-400 text-center mt-6">
                                    Templates provide starting values you can customize. Your organization name and logo will need to be added.
                                </p>
                            </div>
                        </div>
                    </div>
                );
            };

            // Get enabled platforms
            const enabledPlatforms = platforms.filter(p => p.enabled);

            return (
                <div className="flex h-screen flex-col lg:flex-row">

                    {/* Template Modal */}
                    <TemplateModal />

                    {/* === EDITOR PANEL === */}
                    <div className={`w-full lg:w-[440px] xl:w-[500px] bg-white/95 backdrop-blur-sm border-r border-ink-200 flex flex-col h-[calc(100%-56px)] lg:h-full ${activeTab === 'preview' ? 'hidden lg:flex' : 'flex'}`}>

                        {/* Header */}
                        <div className="p-4 border-b border-ink-100 flex items-center justify-between bg-white">
                            <div className="flex items-center gap-3">
                                <div className="w-10 h-10 bg-ink-900 rounded-xl flex items-center justify-center shadow-lg">
                                    <IconNewspaper className="text-white w-5 h-5" />
                                </div>
                                <div>
                                    <h1 className="font-bold text-ink-900 font-serif text-lg">Media Kit Builder</h1>
                                    <p className="text-xs text-ink-500">Professional press kits made easy</p>
                                </div>
                            </div>
                            <div className="flex items-center gap-2">
                                <ProgressRing percentage={completionPercentage} />
                            </div>
                        </div>

                        {/* Toolbar */}
                        <div className="px-4 py-2 border-b border-ink-100 flex items-center justify-between bg-ink-50/50">
                            <div className="flex items-center gap-2">
                                <button
                                    onClick={() => setShowTemplateModal(true)}
                                    className="flex items-center gap-1.5 px-3 py-1.5 text-xs font-medium text-copper-700 bg-copper-50 hover:bg-copper-100 rounded-lg transition-colors"
                                >
                                    <IconTemplate className="w-3.5 h-3.5" />
                                    Templates
                                </button>
                                {profiles.length > 0 && (
                                    <select
                                        className="text-xs border border-ink-200 rounded px-2 py-1.5 bg-white"
                                        onChange={(e) => {
                                            if (e.target.value) loadProfile(e.target.value);
                                        }}
                                        defaultValue=""
                                    >
                                        <option value="">Load profile...</option>
                                        {profiles.map(p => <option key={p.id} value={p.id}>{p.name}</option>)}
                                    </select>
                                )}
                            </div>
                            <div className="flex items-center gap-1">
                                <Tooltip text="Save profile">
                                    <button onClick={saveProfile} className="p-2 text-ink-500 hover:text-ink-700 hover:bg-ink-100 rounded-lg transition-colors">
                                        <IconSave />
                                    </button>
                                </Tooltip>
                                <Tooltip text="Clear draft">
                                    <button onClick={clearDraft} className="p-2 text-ink-500 hover:text-red-600 hover:bg-red-50 rounded-lg transition-colors">
                                        <IconTrash />
                                    </button>
                                </Tooltip>
                            </div>
                        </div>

                        {/* Form Content */}
                        <div className="flex-1 overflow-y-auto p-4 custom-scroll">

                            {/* Theme */}
                            <CollapsibleSection id="theme" title="Theme & Branding">
                                <div className="space-y-4">
                                    <div className="grid grid-cols-2 gap-3">
                                        <div>
                                            <label className="block text-xs font-medium text-ink-600 mb-1">Primary Color</label>
                                            <div className="flex items-center gap-2">
                                                <input
                                                    type="color"
                                                    className="w-8 h-8 rounded cursor-pointer border border-ink-200"
                                                    value={theme.primaryColor}
                                                    onChange={(e) => setTheme({...theme, primaryColor: e.target.value})}
                                                />
                                                <input
                                                    type="text"
                                                    className="input-field flex-1 font-mono text-xs"
                                                    value={theme.primaryColor}
                                                    onChange={(e) => setTheme({...theme, primaryColor: e.target.value})}
                                                />
                                            </div>
                                        </div>
                                        <div>
                                            <label className="block text-xs font-medium text-ink-600 mb-1">Accent Color</label>
                                            <div className="flex items-center gap-2">
                                                <input
                                                    type="color"
                                                    className="w-8 h-8 rounded cursor-pointer border border-ink-200"
                                                    value={theme.accentColor}
                                                    onChange={(e) => setTheme({...theme, accentColor: e.target.value})}
                                                />
                                                <input
                                                    type="text"
                                                    className="input-field flex-1 font-mono text-xs"
                                                    value={theme.accentColor}
                                                    onChange={(e) => setTheme({...theme, accentColor: e.target.value})}
                                                />
                                            </div>
                                        </div>
                                    </div>
                                    <div>
                                        <label className="block text-xs font-medium text-ink-600 mb-1">Rate Card Template</label>
                                        <select
                                            className="input-field"
                                            value={rateTemplate}
                                            onChange={(e) => setRateTemplate(e.target.value)}
                                        >
                                            {Object.entries(RATE_TEMPLATES).map(([key, template]) => (
                                                <option key={key} value={key}>{template.name} - {template.description}</option>
                                            ))}
                                        </select>
                                    </div>
                                </div>
                            </CollapsibleSection>

                            {/* Organization */}
                            <CollapsibleSection id="organization" title="Organization Profile">
                                <div className="space-y-3">
                                    <div>
                                        <label className="block text-xs font-medium text-ink-600 mb-1">
                                            Organization Name <span className="text-red-500">*</span>
                                        </label>
                                        <input
                                            type="text"
                                            className="input-field"
                                            placeholder="Your News Organization"
                                            value={organization.name}
                                            onChange={(e) => setOrganization({...organization, name: e.target.value})}
                                        />
                                    </div>
                                    <div>
                                        <label className="block text-xs font-medium text-ink-600 mb-1">Logo</label>
                                        <label className={`input-field block text-center cursor-pointer hover:bg-ink-50 ${organization.logo ? 'border-sage-500 bg-sage-50' : ''}`}>
                                            <span className="text-ink-500 text-sm flex items-center justify-center gap-2">
                                                {organization.logo ? (
                                                    <><IconCheck className="text-sage-600" /> Change Logo</>
                                                ) : (
                                                    <><IconImage /> Upload Logo (max 5MB)</>
                                                )}
                                            </span>
                                            <input type="file" accept="image/*" className="hidden" onChange={handleLogoUpload} />
                                        </label>
                                    </div>
                                    <div>
                                        <label className="block text-xs font-medium text-ink-600 mb-1">Tagline</label>
                                        <input
                                            type="text"
                                            className="input-field"
                                            placeholder="Your tagline or slogan"
                                            value={organization.tagline}
                                            onChange={(e) => setOrganization({...organization, tagline: e.target.value})}
                                        />
                                    </div>
                                    <div>
                                        <label className="block text-xs font-medium text-ink-600 mb-1">
                                            Mission Statement <span className="text-red-500">*</span>
                                        </label>
                                        <textarea
                                            className="input-field"
                                            rows="3"
                                            placeholder="Describe your mission and values..."
                                            value={organization.mission}
                                            onChange={(e) => setOrganization({...organization, mission: e.target.value})}
                                        />
                                    </div>
                                    <div className="grid grid-cols-2 gap-3">
                                        <div>
                                            <label className="block text-xs font-medium text-ink-600 mb-1">Founded</label>
                                            <input
                                                type="number"
                                                className="input-field"
                                                value={organization.foundedYear}
                                                onChange={(e) => setOrganization({...organization, foundedYear: parseInt(e.target.value) || 2020})}
                                            />
                                        </div>
                                        <div>
                                            <label className="block text-xs font-medium text-ink-600 mb-1">Website</label>
                                            <input
                                                type="url"
                                                className="input-field"
                                                placeholder="https://"
                                                value={organization.website}
                                                onChange={(e) => setOrganization({...organization, website: e.target.value})}
                                            />
                                        </div>
                                    </div>
                                    <div className="pt-2 border-t border-ink-100">
                                        <label className="block text-xs font-medium text-ink-600 mb-2">Contact Person</label>
                                        <div className="space-y-2">
                                            <input
                                                type="text"
                                                className="input-field"
                                                placeholder="Name"
                                                value={organization.contact.name}
                                                onChange={(e) => setOrganization({...organization, contact: {...organization.contact, name: e.target.value}})}
                                            />
                                            <div className="grid grid-cols-2 gap-2">
                                                <input
                                                    type="email"
                                                    className="input-field"
                                                    placeholder="Email"
                                                    value={organization.contact.email}
                                                    onChange={(e) => setOrganization({...organization, contact: {...organization.contact, email: e.target.value}})}
                                                />
                                                <input
                                                    type="tel"
                                                    className="input-field"
                                                    placeholder="Phone"
                                                    value={organization.contact.phone}
                                                    onChange={(e) => setOrganization({...organization, contact: {...organization.contact, phone: e.target.value}})}
                                                />
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </CollapsibleSection>

                            {/* Audience */}
                            <CollapsibleSection id="audience" title="Audience Demographics">
                                <div className="space-y-4">
                                    <div>
                                        <label className="block text-xs font-medium text-ink-600 mb-1">
                                            Total Audience Reach <span className="text-red-500">*</span>
                                        </label>
                                        <input
                                            type="number"
                                            className="input-field"
                                            placeholder="Combined reach across all platforms"
                                            value={audience.totalReach || ''}
                                            onChange={(e) => setAudience({...audience, totalReach: parseInt(e.target.value) || 0})}
                                        />
                                    </div>

                                    <div>
                                        <div className="flex items-center justify-between mb-2">
                                            <label className="text-xs font-medium text-ink-600">Age Distribution</label>
                                            <span className={`text-xs font-mono ${ageRangeTotal !== 100 ? 'text-copper-600' : 'text-sage-600'}`}>
                                                Total: {ageRangeTotal}%
                                            </span>
                                        </div>
                                        {ageRangeTotal !== 100 && (
                                            <p className="text-xs text-copper-600 mb-2 flex items-center gap-1">
                                                <IconInfo /> Age ranges should total 100%
                                            </p>
                                        )}
                                        <div className="space-y-2">
                                            {audience.demographics.ageRanges.map((range, i) => (
                                                <div key={i} className="flex items-center gap-2">
                                                    <span className="text-xs text-ink-500 w-16">{range.range}</span>
                                                    <input
                                                        type="range"
                                                        min="0"
                                                        max="100"
                                                        className="flex-1 accent-copper-500"
                                                        value={range.percentage}
                                                        onChange={(e) => updateAgeRange(i, 'percentage', e.target.value)}
                                                    />
                                                    <span className="text-xs font-mono w-10 text-right">{range.percentage}%</span>
                                                </div>
                                            ))}
                                        </div>
                                    </div>

                                    <div>
                                        <label className="block text-xs font-medium text-ink-600 mb-2">Geographic Distribution</label>
                                        <div className="space-y-2">
                                            {audience.demographics.locations.map((loc, i) => (
                                                <div key={i} className="flex items-center gap-2">
                                                    <input
                                                        type="text"
                                                        className="input-field flex-1"
                                                        placeholder="City/Region"
                                                        value={loc.area}
                                                        onChange={(e) => updateLocation(i, 'area', e.target.value)}
                                                    />
                                                    <input
                                                        type="number"
                                                        className="input-field w-20"
                                                        placeholder="%"
                                                        value={loc.percentage || ''}
                                                        onChange={(e) => updateLocation(i, 'percentage', e.target.value)}
                                                    />
                                                    {audience.demographics.locations.length > 1 && (
                                                        <button onClick={() => removeLocation(i)} className="text-ink-400 hover:text-red-500 transition-colors">
                                                            <IconTrash />
                                                        </button>
                                                    )}
                                                </div>
                                            ))}
                                            <button
                                                onClick={addLocation}
                                                className="text-xs text-copper-600 hover:text-copper-700 flex items-center gap-1"
                                            >
                                                <IconPlus /> Add Location
                                            </button>
                                        </div>
                                    </div>

                                    <div>
                                        <label className="block text-xs font-medium text-ink-600 mb-1">Audience Interests</label>
                                        <input
                                            type="text"
                                            className="input-field"
                                            placeholder="Comma-separated: Local news, Politics, Business..."
                                            value={audience.demographics.interests.join(', ')}
                                            onChange={(e) => setAudience({
                                                ...audience,
                                                demographics: {
                                                    ...audience.demographics,
                                                    interests: e.target.value.split(',').map(s => s.trim()).filter(Boolean)
                                                }
                                            })}
                                        />
                                    </div>
                                </div>
                            </CollapsibleSection>

                            {/* Platforms */}
                            <CollapsibleSection id="platforms" title="Platforms & Ad Rates" badge={`${enabledPlatforms.length} active`}>
                                <div className="space-y-3">
                                    <p className="text-xs text-ink-500 flex items-center gap-1">
                                        <IconGripVertical className="text-ink-400" /> Drag to reorder platforms
                                    </p>
                                    {platforms.map(platform => (
                                        <div
                                            key={platform.id}
                                            draggable
                                            onDragStart={(e) => handleDragStart(e, platform.id)}
                                            onDragOver={(e) => handleDragOver(e, platform.id)}
                                            onDragEnd={handleDragEnd}
                                            className={`border rounded-lg transition-all duration-200 ${
                                                platform.enabled ? 'border-copper-200 bg-copper-50/30' : 'border-ink-200'
                                            } ${draggedPlatform === platform.id ? 'opacity-50' : ''}`}
                                        >
                                            <div className="p-3 flex items-center justify-between">
                                                <div className="flex items-center gap-2">
                                                    <IconGripVertical className="text-ink-300 cursor-grab" />
                                                    <label className="flex items-center gap-2 cursor-pointer">
                                                        <input
                                                            type="checkbox"
                                                            checked={platform.enabled}
                                                            onChange={() => togglePlatform(platform.id)}
                                                            className="w-4 h-4 text-copper-600 rounded accent-copper-600"
                                                        />
                                                        <span className="font-medium text-sm">{platform.name}</span>
                                                    </label>
                                                </div>
                                            </div>

                                            {platform.enabled && (
                                                <div className="px-3 pb-3 space-y-3">
                                                    {/* Metrics */}
                                                    <div>
                                                        <span className="text-xs font-medium text-ink-500">Metrics</span>
                                                        <div className="grid grid-cols-2 gap-2 mt-1">
                                                            {platform.metrics.map((metric, i) => (
                                                                <div key={i}>
                                                                    <label className="text-[10px] text-ink-400">{metric.label}</label>
                                                                    <input
                                                                        type="text"
                                                                        className="input-field py-1.5 text-xs"
                                                                        placeholder="0"
                                                                        value={metric.value}
                                                                        onChange={(e) => updatePlatformMetric(platform.id, i, e.target.value)}
                                                                    />
                                                                </div>
                                                            ))}
                                                        </div>
                                                    </div>

                                                    {/* Ad Options */}
                                                    <div>
                                                        <span className="text-xs font-medium text-ink-500">Ad Options</span>
                                                        <div className="space-y-2 mt-1">
                                                            {platform.adOptions.map((option, i) => (
                                                                <div key={i} className="bg-white p-2 rounded border border-ink-100 space-y-1">
                                                                    <div className="flex items-center gap-2">
                                                                        <input
                                                                            type="text"
                                                                            className="input-field py-1 text-xs flex-1"
                                                                            placeholder="Ad unit name"
                                                                            value={option.name}
                                                                            onChange={(e) => updateAdOption(platform.id, i, 'name', e.target.value)}
                                                                        />
                                                                        <input
                                                                            type="text"
                                                                            className="input-field py-1 text-xs w-24"
                                                                            placeholder="$000"
                                                                            value={option.rate}
                                                                            onChange={(e) => updateAdOption(platform.id, i, 'rate', e.target.value)}
                                                                        />
                                                                        {platform.adOptions.length > 1 && (
                                                                            <button onClick={() => removeAdOption(platform.id, i)} className="text-ink-400 hover:text-red-500">
                                                                                <IconTrash />
                                                                            </button>
                                                                        )}
                                                                    </div>
                                                                    <input
                                                                        type="text"
                                                                        className="input-field py-1 text-xs"
                                                                        placeholder="Description"
                                                                        value={option.description}
                                                                        onChange={(e) => updateAdOption(platform.id, i, 'description', e.target.value)}
                                                                    />
                                                                    <input
                                                                        type="text"
                                                                        className="input-field py-1 text-xs"
                                                                        placeholder="Specs (dimensions, file type, etc.)"
                                                                        value={option.specs}
                                                                        onChange={(e) => updateAdOption(platform.id, i, 'specs', e.target.value)}
                                                                    />
                                                                </div>
                                                            ))}
                                                            <button
                                                                onClick={() => addAdOption(platform.id)}
                                                                className="text-xs text-copper-600 hover:text-copper-700 flex items-center gap-1"
                                                            >
                                                                <IconPlus /> Add Ad Option
                                                            </button>
                                                        </div>
                                                    </div>
                                                </div>
                                            )}
                                        </div>
                                    ))}
                                </div>
                            </CollapsibleSection>

                            {/* Testimonials */}
                            <CollapsibleSection id="testimonials" title="Testimonials">
                                <div className="space-y-3">
                                    {testimonials.map(t => (
                                        <div key={t.id} className="bg-ink-50 p-3 rounded-lg space-y-2">
                                            <textarea
                                                className="input-field text-sm"
                                                rows="2"
                                                placeholder="Quote from advertiser or partner..."
                                                value={t.quote}
                                                onChange={(e) => updateTestimonial(t.id, 'quote', e.target.value)}
                                            />
                                            <div className="flex items-center gap-2">
                                                <input
                                                    type="text"
                                                    className="input-field flex-1"
                                                    placeholder="Source name"
                                                    value={t.source}
                                                    onChange={(e) => updateTestimonial(t.id, 'source', e.target.value)}
                                                />
                                                <button onClick={() => removeTestimonial(t.id)} className="text-ink-400 hover:text-red-500">
                                                    <IconTrash />
                                                </button>
                                            </div>
                                        </div>
                                    ))}
                                    <button
                                        onClick={addTestimonial}
                                        className="w-full py-2 border-2 border-dashed border-ink-200 rounded-lg text-xs text-ink-500 hover:border-ink-300 flex items-center justify-center gap-1 transition-colors"
                                    >
                                        <IconPlus /> Add Testimonial
                                    </button>
                                </div>
                            </CollapsibleSection>

                            {/* Advertising Packages */}
                            <CollapsibleSection id="packages" title="Advertising Packages" badge={packages.length > 0 ? `${packages.length} packages` : null}>
                                <div className="space-y-4">
                                    <p className="text-xs text-ink-500">
                                        Bundle ad options into packages to offer discounts and simplify purchasing for advertisers.
                                    </p>

                                    {/* Preset buttons */}
                                    <div className="flex flex-wrap gap-2">
                                        <button
                                            onClick={() => addPresetPackage('starter')}
                                            className="px-3 py-1.5 text-xs font-medium bg-sage-50 text-sage-700 hover:bg-sage-100 rounded-lg transition-colors"
                                        >
                                            + Starter
                                        </button>
                                        <button
                                            onClick={() => addPresetPackage('growth')}
                                            className="px-3 py-1.5 text-xs font-medium bg-copper-50 text-copper-700 hover:bg-copper-100 rounded-lg transition-colors"
                                        >
                                            + Growth
                                        </button>
                                        <button
                                            onClick={() => addPresetPackage('premium')}
                                            className="px-3 py-1.5 text-xs font-medium bg-ink-100 text-ink-700 hover:bg-ink-200 rounded-lg transition-colors"
                                        >
                                            + Premium
                                        </button>
                                    </div>

                                    {/* Package list */}
                                    {packages.map(pkg => (
                                        <div key={pkg.id} className="border border-ink-200 rounded-lg p-3 space-y-3">
                                            <div className="flex items-start gap-2">
                                                <IconPackage className="text-copper-500 mt-1 flex-shrink-0" />
                                                <div className="flex-1 space-y-2">
                                                    <input
                                                        type="text"
                                                        className="input-field font-medium"
                                                        placeholder="Package Name"
                                                        value={pkg.name}
                                                        onChange={(e) => updatePackage(pkg.id, 'name', e.target.value)}
                                                    />
                                                    <input
                                                        type="text"
                                                        className="input-field text-sm"
                                                        placeholder="Brief description..."
                                                        value={pkg.description}
                                                        onChange={(e) => updatePackage(pkg.id, 'description', e.target.value)}
                                                    />
                                                </div>
                                                <button
                                                    onClick={() => removePackage(pkg.id)}
                                                    className="text-ink-400 hover:text-red-500 transition-colors"
                                                >
                                                    <IconTrash />
                                                </button>
                                            </div>

                                            {/* Package items */}
                                            <div className="space-y-2">
                                                <label className="text-xs font-medium text-ink-500">Included Items</label>
                                                {pkg.items.map(item => (
                                                    <div key={item.id} className="flex items-center gap-2 bg-ink-50 p-2 rounded">
                                                        <select
                                                            className="input-field flex-1 py-1.5 text-xs"
                                                            value={item.platform}
                                                            onChange={(e) => updatePackageItem(pkg.id, item.id, 'platform', e.target.value)}
                                                        >
                                                            <option value="">Select platform...</option>
                                                            {platforms.filter(p => p.enabled).map(p => (
                                                                <option key={p.id} value={p.name}>{p.name}</option>
                                                            ))}
                                                        </select>
                                                        <select
                                                            className="input-field flex-1 py-1.5 text-xs"
                                                            value={item.adOption}
                                                            onChange={(e) => updatePackageItem(pkg.id, item.id, 'adOption', e.target.value)}
                                                        >
                                                            <option value="">Select ad...</option>
                                                            {item.platform && platforms.find(p => p.name === item.platform)?.adOptions.map((opt, i) => (
                                                                <option key={i} value={opt.name}>{opt.name}</option>
                                                            ))}
                                                        </select>
                                                        <input
                                                            type="number"
                                                            min="1"
                                                            className="input-field w-14 py-1.5 text-xs text-center"
                                                            placeholder="Qty"
                                                            value={item.quantity}
                                                            onChange={(e) => updatePackageItem(pkg.id, item.id, 'quantity', parseInt(e.target.value) || 1)}
                                                        />
                                                        <button
                                                            onClick={() => removePackageItem(pkg.id, item.id)}
                                                            className="text-ink-400 hover:text-red-500"
                                                        >
                                                            <IconX className="w-3 h-3" />
                                                        </button>
                                                    </div>
                                                ))}
                                                <button
                                                    onClick={() => addPackageItem(pkg.id)}
                                                    className="text-xs text-copper-600 hover:text-copper-700 flex items-center gap-1"
                                                >
                                                    <IconPlus /> Add Item
                                                </button>
                                            </div>

                                            {/* Pricing */}
                                            <div className="grid grid-cols-3 gap-2 pt-2 border-t border-ink-100">
                                                <div>
                                                    <label className="text-[10px] text-ink-400">Total Value</label>
                                                    <input
                                                        type="text"
                                                        className="input-field py-1.5 text-xs"
                                                        placeholder="$0"
                                                        value={pkg.totalValue}
                                                        onChange={(e) => updatePackage(pkg.id, 'totalValue', e.target.value)}
                                                    />
                                                </div>
                                                <div>
                                                    <label className="text-[10px] text-ink-400">Package Price</label>
                                                    <input
                                                        type="text"
                                                        className="input-field py-1.5 text-xs"
                                                        placeholder="$0"
                                                        value={pkg.price}
                                                        onChange={(e) => updatePackage(pkg.id, 'price', e.target.value)}
                                                    />
                                                </div>
                                                <div>
                                                    <label className="text-[10px] text-ink-400">Savings</label>
                                                    <input
                                                        type="text"
                                                        className="input-field py-1.5 text-xs"
                                                        placeholder="10%"
                                                        value={pkg.savings}
                                                        onChange={(e) => updatePackage(pkg.id, 'savings', e.target.value)}
                                                    />
                                                </div>
                                            </div>
                                        </div>
                                    ))}

                                    {/* Add custom package */}
                                    <button
                                        onClick={addPackage}
                                        className="w-full py-2 border-2 border-dashed border-ink-200 rounded-lg text-xs text-ink-500 hover:border-ink-300 flex items-center justify-center gap-1 transition-colors"
                                    >
                                        <IconPlus /> Add Custom Package
                                    </button>
                                </div>
                            </CollapsibleSection>

                            {/* Attribution */}
                            <div className="py-4 text-center text-xs text-ink-400">
                                <p>Media Kit Builder | Â© 2025 <a href="https://centerforcooperativemedia.org/" className="hover:text-copper-600 transition-colors">Center for Cooperative Media</a></p>
                                <p>Created by <a href="https://twitter.com/jsamditis" className="hover:text-copper-600 transition-colors">Joe Amditis</a></p>
                            </div>
                        </div>
                    </div>

                    {/* === PREVIEW PANEL === */}
                    <div className={`flex-1 bg-ink-100/50 flex flex-col h-[calc(100%-56px)] lg:h-full ${activeTab === 'editor' ? 'hidden lg:flex' : 'flex'}`}>

                        {/* Toolbar */}
                        <div className="p-4 bg-white border-b border-ink-200 flex items-center justify-between">
                            <div className="flex items-center gap-2">
                                <select
                                    className="text-sm border border-ink-200 rounded-lg px-3 py-2 bg-white"
                                    value={exportType}
                                    onChange={(e) => setExportType(e.target.value)}
                                >
                                    <option value="pdf">PDF Document</option>
                                    <option value="png">PNG Image</option>
                                </select>
                            </div>
                            <button
                                onClick={handleDownload}
                                disabled={isGenerating}
                                className="btn btn-copper flex items-center gap-2"
                            >
                                {isGenerating ? (
                                    <>
                                        <span className="animate-pulse-soft">Generating...</span>
                                    </>
                                ) : (
                                    <>
                                        <IconDownload /> Download {exportType.toUpperCase()}
                                    </>
                                )}
                            </button>
                        </div>

                        {/* Preview */}
                        <div className="flex-1 overflow-auto p-6 custom-scroll">
                            <div
                                id="media-kit-preview"
                                className="bg-white shadow-xl max-w-[800px] mx-auto"
                                style={{ fontFamily: 'Instrument Sans, sans-serif' }}
                            >
                                {/* Header */}
                                <header
                                    className="p-8 text-white relative overflow-hidden"
                                    style={{ backgroundColor: theme.primaryColor }}
                                >
                                    {/* Decorative element */}
                                    <div
                                        className="absolute top-0 right-0 w-64 h-64 rounded-full opacity-10"
                                        style={{ backgroundColor: theme.accentColor, transform: 'translate(30%, -30%)' }}
                                    />
                                    <div className="relative flex items-start justify-between">
                                        <div className="flex-1">
                                            {organization.logo && (
                                                <img src={organization.logo} alt="Logo" className="h-14 mb-4 object-contain" />
                                            )}
                                            <h1 className="text-3xl font-bold mb-1" style={{ fontFamily: 'Fraunces, serif' }}>
                                                {organization.name || 'Your Organization'}
                                            </h1>
                                            {organization.tagline && (
                                                <p className="text-white/80 text-sm">{organization.tagline}</p>
                                            )}
                                        </div>
                                        <div className="text-right">
                                            <p className="text-2xl font-bold mb-1" style={{ fontFamily: 'Fraunces, serif' }}>
                                                Media Kit
                                            </p>
                                            <p className="text-white/70 text-sm">{new Date().getFullYear()}</p>
                                            {rateTemplate !== 'standard' && (
                                                <span
                                                    className="inline-block mt-2 px-2 py-1 text-xs font-medium rounded"
                                                    style={{ backgroundColor: theme.accentColor }}
                                                >
                                                    {RATE_TEMPLATES[rateTemplate].name} Rates
                                                </span>
                                            )}
                                        </div>
                                    </div>
                                </header>

                                <div className="p-8 space-y-8">
                                    {/* Mission */}
                                    {organization.mission && (
                                        <section>
                                            <h2 className="text-lg font-bold mb-3" style={{ color: theme.primaryColor, fontFamily: 'Fraunces, serif' }}>About Us</h2>
                                            <p className="text-gray-600 text-sm leading-relaxed">{organization.mission}</p>
                                            {organization.foundedYear && (
                                                <p className="text-xs text-gray-400 mt-2">Established {organization.foundedYear}</p>
                                            )}
                                        </section>
                                    )}

                                    {/* Audience */}
                                    {audience.totalReach > 0 && (
                                        <section>
                                            <h2 className="text-lg font-bold mb-4" style={{ color: theme.primaryColor, fontFamily: 'Fraunces, serif' }}>Our Audience</h2>

                                            <div className="text-center mb-6 p-6 rounded-xl" style={{ backgroundColor: theme.primaryColor + '08' }}>
                                                <p className="text-4xl font-bold" style={{ color: theme.primaryColor, fontFamily: 'Fraunces, serif' }}>
                                                    {audience.totalReach.toLocaleString()}
                                                </p>
                                                <p className="text-xs text-gray-500 uppercase tracking-wider mt-1">Total Reach</p>
                                            </div>

                                            <div className="grid grid-cols-2 gap-6">
                                                {/* Age Distribution */}
                                                <div>
                                                    <h3 className="text-xs font-semibold text-gray-500 uppercase tracking-wider mb-3">Age Distribution</h3>
                                                    <div className="space-y-2">
                                                        {audience.demographics.ageRanges.map((range, i) => (
                                                            <div key={i} className="flex items-center gap-2">
                                                                <span className="text-xs text-gray-500 w-12">{range.range}</span>
                                                                <div className="flex-1 bg-gray-100 rounded-full h-4 overflow-hidden">
                                                                    <div
                                                                        className="h-full rounded-full transition-all"
                                                                        style={{
                                                                            width: `${range.percentage}%`,
                                                                            backgroundColor: theme.primaryColor
                                                                        }}
                                                                    />
                                                                </div>
                                                                <span className="text-xs font-mono text-gray-600 w-8">{range.percentage}%</span>
                                                            </div>
                                                        ))}
                                                    </div>
                                                </div>

                                                {/* Locations */}
                                                {audience.demographics.locations.some(l => l.area) && (
                                                    <div>
                                                        <h3 className="text-xs font-semibold text-gray-500 uppercase tracking-wider mb-3">Top Locations</h3>
                                                        <div className="space-y-2">
                                                            {audience.demographics.locations.filter(l => l.area).map((loc, i) => (
                                                                <div key={i} className="flex items-center justify-between">
                                                                    <span className="text-sm text-gray-700">{loc.area}</span>
                                                                    <span className="text-sm font-mono font-medium" style={{ color: theme.accentColor }}>{loc.percentage}%</span>
                                                                </div>
                                                            ))}
                                                        </div>
                                                    </div>
                                                )}
                                            </div>

                                            {/* Interests */}
                                            {audience.demographics.interests.length > 0 && (
                                                <div className="mt-4">
                                                    <h3 className="text-xs font-semibold text-gray-500 uppercase tracking-wider mb-2">Interests</h3>
                                                    <div className="flex flex-wrap gap-2">
                                                        {audience.demographics.interests.map((interest, i) => (
                                                            <span
                                                                key={i}
                                                                className="px-3 py-1 rounded-full text-xs font-medium"
                                                                style={{ backgroundColor: theme.accentColor + '20', color: theme.accentColor }}
                                                            >
                                                                {interest}
                                                            </span>
                                                        ))}
                                                    </div>
                                                </div>
                                            )}
                                        </section>
                                    )}

                                    {/* Platforms & Ad Rates */}
                                    {enabledPlatforms.length > 0 && (
                                        <section>
                                            <h2 className="text-lg font-bold mb-4" style={{ color: theme.primaryColor, fontFamily: 'Fraunces, serif' }}>Advertising Opportunities</h2>

                                            <div className="space-y-6">
                                                {enabledPlatforms.map(platform => (
                                                    <div key={platform.id} className="border border-gray-200 rounded-xl overflow-hidden">
                                                        <div className="px-4 py-3 font-semibold text-sm" style={{ backgroundColor: theme.primaryColor + '08', color: theme.primaryColor }}>
                                                            {platform.name}
                                                        </div>
                                                        <div className="p-4">
                                                            {/* Metrics */}
                                                            {platform.metrics.some(m => m.value) && (
                                                                <div className="flex flex-wrap gap-6 mb-4 pb-4 border-b border-gray-100">
                                                                    {platform.metrics.filter(m => m.value).map((metric, i) => (
                                                                        <div key={i}>
                                                                            <p className="text-xl font-bold" style={{ color: theme.primaryColor }}>{metric.value}</p>
                                                                            <p className="text-xs text-gray-500">{metric.label}</p>
                                                                        </div>
                                                                    ))}
                                                                </div>
                                                            )}

                                                            {/* Ad Options */}
                                                            <div className="space-y-3">
                                                                {platform.adOptions.filter(o => o.name).map((option, i) => (
                                                                    <div key={i} className="flex items-start justify-between">
                                                                        <div className="flex-1">
                                                                            <p className="font-medium text-sm text-gray-900">{option.name}</p>
                                                                            {option.description && (
                                                                                <p className="text-xs text-gray-500">{option.description}</p>
                                                                            )}
                                                                            {option.specs && (
                                                                                <p className="text-xs text-gray-400 mt-0.5 font-mono">{option.specs}</p>
                                                                            )}
                                                                        </div>
                                                                        {option.rate && (
                                                                            <p className="font-bold text-sm ml-4" style={{ color: theme.accentColor }}>{option.rate}</p>
                                                                        )}
                                                                    </div>
                                                                ))}
                                                            </div>
                                                        </div>
                                                    </div>
                                                ))}
                                            </div>
                                        </section>
                                    )}

                                    {/* Advertising Packages */}
                                    {packages.length > 0 && packages.some(p => p.name) && (
                                        <section>
                                            <h2 className="text-lg font-bold mb-4" style={{ color: theme.primaryColor, fontFamily: 'Fraunces, serif' }}>Advertising Packages</h2>
                                            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                                {packages.filter(p => p.name).map(pkg => (
                                                    <div key={pkg.id} className="border border-gray-200 rounded-xl p-4 relative overflow-hidden">
                                                        {pkg.savings && (
                                                            <div
                                                                className="absolute top-3 right-3 px-2 py-0.5 text-[10px] font-bold rounded"
                                                                style={{ backgroundColor: theme.accentColor, color: 'white' }}
                                                            >
                                                                Save {pkg.savings}
                                                            </div>
                                                        )}
                                                        <h3 className="font-semibold text-sm mb-1" style={{ color: theme.primaryColor }}>
                                                            {pkg.name}
                                                        </h3>
                                                        {pkg.description && (
                                                            <p className="text-xs text-gray-500 mb-3">{pkg.description}</p>
                                                        )}

                                                        {pkg.items.length > 0 && (
                                                            <div className="space-y-1 mb-3">
                                                                {pkg.items.filter(item => item.adOption).map(item => (
                                                                    <div key={item.id} className="flex items-center gap-2 text-xs text-gray-600">
                                                                        <span className="w-1 h-1 rounded-full" style={{ backgroundColor: theme.accentColor }} />
                                                                        {item.quantity > 1 && <span className="font-medium">{item.quantity}x</span>}
                                                                        <span>{item.adOption}</span>
                                                                        <span className="text-gray-400">({item.platform})</span>
                                                                    </div>
                                                                ))}
                                                            </div>
                                                        )}

                                                        <div className="flex items-baseline gap-2">
                                                            {pkg.price && (
                                                                <span className="text-xl font-bold" style={{ color: theme.primaryColor }}>
                                                                    {pkg.price}
                                                                </span>
                                                            )}
                                                            {pkg.totalValue && (
                                                                <span className="text-xs text-gray-400 line-through">
                                                                    {pkg.totalValue}
                                                                </span>
                                                            )}
                                                        </div>
                                                    </div>
                                                ))}
                                            </div>
                                        </section>
                                    )}

                                    {/* Testimonials */}
                                    {testimonials.length > 0 && testimonials.some(t => t.quote) && (
                                        <section>
                                            <h2 className="text-lg font-bold mb-4" style={{ color: theme.primaryColor, fontFamily: 'Fraunces, serif' }}>What Partners Say</h2>
                                            <div className="space-y-4">
                                                {testimonials.filter(t => t.quote).map(t => (
                                                    <blockquote key={t.id} className="border-l-4 pl-4 italic text-gray-600 text-sm" style={{ borderColor: theme.accentColor }}>
                                                        "{t.quote}"
                                                        {t.source && <footer className="mt-1 text-xs text-gray-400 not-italic">â€” {t.source}</footer>}
                                                    </blockquote>
                                                ))}
                                            </div>
                                        </section>
                                    )}

                                    {/* Contact */}
                                    {(organization.contact.name || organization.contact.email) && (
                                        <section className="pt-6 border-t border-gray-200">
                                            <h2 className="text-lg font-bold mb-3" style={{ color: theme.primaryColor, fontFamily: 'Fraunces, serif' }}>Get in Touch</h2>
                                            <div className="text-sm text-gray-600">
                                                {organization.contact.name && <p className="font-medium">{organization.contact.name}</p>}
                                                {organization.contact.email && <p>{organization.contact.email}</p>}
                                                {organization.contact.phone && <p>{organization.contact.phone}</p>}
                                                {organization.website && (
                                                    <p className="mt-2 font-medium" style={{ color: theme.primaryColor }}>{organization.website}</p>
                                                )}
                                            </div>
                                        </section>
                                    )}
                                </div>

                                {/* Footer */}
                                <footer className="px-8 py-4 bg-gray-50 text-center text-xs text-gray-400 border-t border-gray-100">
                                    Generated with Media Kit Builder by Center for Cooperative Media
                                </footer>
                            </div>
                        </div>
                    </div>

                    {/* === MOBILE TAB BAR === */}
                    <div className="lg:hidden fixed bottom-0 left-0 w-full bg-white border-t border-ink-200 flex h-14 z-50">
                        <button
                            onClick={() => setActiveTab('editor')}
                            className={`flex-1 flex flex-col items-center justify-center gap-1 transition-colors ${activeTab === 'editor' ? 'text-copper-600' : 'text-ink-400'}`}
                        >
                            <IconEdit />
                            <span className="text-[10px] font-medium">Editor</span>
                        </button>
                        <button
                            onClick={() => setActiveTab('preview')}
                            className={`flex-1 flex flex-col items-center justify-center gap-1 transition-colors ${activeTab === 'preview' ? 'text-copper-600' : 'text-ink-400'}`}
                        >
                            <IconEye />
                            <span className="text-[10px] font-medium">Preview</span>
                        </button>
                    </div>
                </div>
            );
        };

        // App with Toast Provider
        const App = () => (
            <ToastProvider>
                <MediaKitBuilder />
            </ToastProvider>
        );

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
